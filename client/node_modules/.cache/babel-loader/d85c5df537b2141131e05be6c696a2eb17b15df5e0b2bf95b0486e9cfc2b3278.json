{"ast":null,"code":"var _s = $RefreshSig$();\n// socket.js - Socket.io client setup\n\nimport { io } from \"socket.io-client\";\nimport { useEffect, useState } from \"react\";\n\n// Socket.io connection URL - fixed for Create React App\nconst SOCKET_URL = process.env.REACT_APP_SOCKET_URL || \"http://localhost:5000\";\n\n// Create socket instance with enhanced configuration\nexport const socket = io(SOCKET_URL, {\n  autoConnect: true,\n  reconnection: true,\n  reconnectionAttempts: 10,\n  reconnectionDelay: 1000,\n  reconnectionDelayMax: 5000,\n  timeout: 20000,\n  transports: ['websocket', 'polling'] // Fallback support\n});\n\n// Available reaction types with emojis\nexport const REACTION_TYPES = {\n  like: 'ðŸ‘',\n  love: 'â¤ï¸',\n  laugh: 'ðŸ˜‚',\n  wow: 'ðŸ˜®',\n  sad: 'ðŸ˜¢',\n  angry: 'ðŸ˜ '\n};\n\n// Custom hook for using socket.io\nexport const useSocket = () => {\n  _s();\n  const [isConnected, setIsConnected] = useState(socket.connected);\n  const [isReconnecting, setIsReconnecting] = useState(false);\n  const [connectionError, setConnectionError] = useState(null);\n  const [lastMessage, setLastMessage] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [privateMessages, setPrivateMessages] = useState([]);\n  const [users, setUsers] = useState([]);\n  const [typingUsers, setTypingUsers] = useState([]);\n  const [rooms, setRooms] = useState([]);\n  const [currentRoom, setCurrentRoom] = useState('general');\n  const [messageHistory, setMessageHistory] = useState(new Map()); // Room -> messages\n  const [hasMoreMessages, setHasMoreMessages] = useState(new Map()); // Room -> boolean\n\n  // Connect to socket server\n  const connect = (username, room = 'general') => {\n    console.log(\"ðŸš€ Emitting user_join event with username:\", username, \"room:\", room);\n    if (username) {\n      socket.emit(\"user_join\", {\n        username,\n        room\n      });\n      setCurrentRoom(room);\n    }\n  };\n\n  // Disconnect from socket server\n  const disconnect = () => {\n    socket.disconnect();\n  };\n\n  // Send a public message\n  const sendMessage = messageData => {\n    console.log(\"ðŸ“¤ Sending public message:\", messageData);\n    socket.emit(\"send_message\", messageData);\n  };\n\n  // Send a file message\n  const sendFileMessage = fileData => {\n    console.log(\"ðŸ“ Sending file message:\", fileData);\n    socket.emit(\"send_file_message\", fileData);\n  };\n\n  // Send a private message\n  const sendPrivateMessage = (to, message, from) => {\n    console.log(\"ðŸ”’ Sending private message to:\", to, \"content:\", message);\n    socket.emit(\"private_message\", {\n      to,\n      message\n    });\n  };\n\n  // Add reaction to message\n  const addReaction = (messageId, reactionType) => {\n    console.log(\"ðŸŽ­ Adding reaction:\", reactionType, \"to message:\", messageId);\n    socket.emit(\"add_reaction\", {\n      messageId,\n      reactionType\n    });\n  };\n\n  // Remove reaction from message\n  const removeReaction = (messageId, reactionType) => {\n    console.log(\"ðŸŽ­ Removing reaction:\", reactionType, \"from message:\", messageId);\n    socket.emit(\"remove_reaction\", {\n      messageId,\n      reactionType\n    });\n  };\n\n  // Mark message as read\n  const markMessageRead = messageId => {\n    console.log(\"ðŸ‘€ Marking message as read:\", messageId);\n    socket.emit(\"mark_message_read\", {\n      messageId\n    });\n  };\n\n  // Mark all messages as read in room\n  const markAllMessagesRead = room => {\n    console.log(\"ðŸ‘€ Marking all messages as read in room:\", room);\n    socket.emit(\"mark_all_read\", {\n      room\n    });\n  };\n\n  // Mark private message as read\n  const markPrivateMessageRead = (messageId, fromUser) => {\n    console.log(\"ðŸ‘€ Marking private message as read:\", messageId, \"from:\", fromUser);\n    socket.emit(\"mark_private_message_read\", {\n      messageId,\n      fromUser\n    });\n  };\n\n  // Change room\n  const changeRoom = newRoom => {\n    console.log(\"ðŸ”„ Changing room to:\", newRoom);\n    socket.emit(\"change_room\", {\n      newRoom\n    });\n    setCurrentRoom(newRoom);\n    // Don't clear messages - they're stored per room now\n  };\n\n  // Create new room\n  const createRoom = roomName => {\n    console.log(\"ðŸ—ï¸ Creating new room:\", roomName);\n    socket.emit(\"create_room\", roomName);\n  };\n\n  // Load more messages (pagination)\n  const loadMoreMessages = async (room, page = 1) => {\n    console.log(\"ðŸ“š Loading more messages for room:\", room, \"page:\", page);\n    try {\n      const response = await fetch(`http://localhost:5000/messages/${room}?page=${page}&limit=20`);\n      if (!response.ok) {\n        throw new Error('Failed to load messages');\n      }\n      const data = await response.json();\n      return data;\n    } catch (error) {\n      console.error('Error loading more messages:', error);\n      throw error;\n    }\n  };\n\n  // Load more messages via socket (alternative method)\n  const loadMoreMessagesSocket = (room, page = 1) => {\n    console.log(\"ðŸ“š Loading more messages via socket for room:\", room, \"page:\", page);\n    socket.emit(\"load_more_messages\", {\n      room,\n      page,\n      limit: 20\n    });\n  };\n\n  // Set typing status\n  const setTyping = (isTyping, room = currentRoom) => {\n    socket.emit(\"typing\", {\n      isTyping,\n      room\n    });\n  };\n\n  // Upload file to server\n  const uploadFile = async file => {\n    const formData = new FormData();\n    formData.append('file', file);\n    try {\n      const response = await fetch('http://localhost:5000/upload', {\n        method: 'POST',\n        body: formData\n      });\n      if (!response.ok) {\n        throw new Error('Upload failed');\n      }\n      const fileInfo = await response.json();\n      return fileInfo;\n    } catch (error) {\n      console.error('Upload error:', error);\n      throw error;\n    }\n  };\n\n  // Update message reactions\n  const updateMessageReactions = (messageId, newReactions) => {\n    setMessages(prev => prev.map(msg => msg.id === messageId ? {\n      ...msg,\n      reactions: newReactions\n    } : msg));\n  };\n\n  // Update message read receipts\n  const updateMessageReadReceipts = (messageId, readBy) => {\n    setMessages(prev => prev.map(msg => msg.id === messageId ? {\n      ...msg,\n      readBy\n    } : msg));\n  };\n\n  // Update private message read status\n  const updatePrivateMessageReadStatus = (messageId, readBy) => {\n    setPrivateMessages(prev => prev.map(msg => msg.id === messageId ? {\n      ...msg,\n      read: true,\n      readBy\n    } : msg));\n  };\n\n  // Add messages to history for a room\n  const addMessagesToHistory = (room, newMessages) => {\n    setMessageHistory(prev => {\n      const newHistory = new Map(prev);\n      const existingMessages = newHistory.get(room) || [];\n      const messageIds = new Set(existingMessages.map(m => m.id));\n\n      // Filter out duplicates and add new messages\n      const uniqueNewMessages = newMessages.filter(msg => !messageIds.has(msg.id));\n      newHistory.set(room, [...existingMessages, ...uniqueNewMessages]);\n      return newHistory;\n    });\n  };\n\n  // Socket event listeners\n  useEffect(() => {\n    const onConnect = () => {\n      console.log(\"âœ… Connected to server, socket ID:\", socket.id);\n      setIsConnected(true);\n      setIsReconnecting(false);\n      setConnectionError(null);\n    };\n    const onDisconnect = reason => {\n      console.log(\"âŒ Disconnected from server. Reason:\", reason);\n      setIsConnected(false);\n      if (reason === 'io server disconnect') {\n        // Server initiated disconnect, need to manually reconnect\n        socket.connect();\n      }\n    };\n    const onConnectError = error => {\n      console.log(\"ðŸ”Œ Connection error:\", error);\n      setConnectionError(error.message);\n      setIsReconnecting(false);\n    };\n    const onReconnect = attemptNumber => {\n      console.log(\"ðŸ”„ Reconnected after\", attemptNumber, \"attempts\");\n      setIsConnected(true);\n      setIsReconnecting(false);\n      setConnectionError(null);\n    };\n    const onReconnectAttempt = attemptNumber => {\n      console.log(\"ðŸ”„ Reconnection attempt:\", attemptNumber);\n      setIsReconnecting(true);\n    };\n    const onReconnectError = error => {\n      console.log(\"ðŸ”„ Reconnection error:\", error);\n      setConnectionError(error.message);\n    };\n    const onReconnectFailed = () => {\n      console.log(\"ðŸ”„ Reconnection failed\");\n      setIsReconnecting(false);\n      setConnectionError('Failed to reconnect to server');\n    };\n    const onReceiveMessage = message => {\n      console.log(\"ðŸ“¨ Received message for room:\", message.room, \"content:\", message);\n\n      // Add to current messages if it's for the current room\n      if (!message.room || message.room === currentRoom || message.system) {\n        setLastMessage(message);\n        setMessages(prev => {\n          // Prevent duplicates\n          if (prev.some(msg => msg.id === message.id)) return prev;\n          return [...prev, message];\n        });\n      }\n\n      // Always add to message history\n      if (message.room) {\n        addMessagesToHistory(message.room, [message]);\n      }\n    };\n    const onPrivateMessage = message => {\n      console.log(\"ðŸ”’ Received private message:\", message);\n      setPrivateMessages(prev => {\n        // Prevent duplicates\n        if (prev.some(msg => msg.id === message.id)) return prev;\n        return [...prev, message];\n      });\n    };\n    const onPrivateMessageError = error => {\n      console.log(\"âŒ Private message error:\", error);\n      alert(`Error: ${error.error}`);\n    };\n    const onUserList = userList => {\n      console.log(\"ðŸ‘¥ User list updated:\", userList);\n      setUsers(userList);\n    };\n    const onUserJoined = user => {\n      console.log(\"ðŸŸ¢ User joined:\", user);\n      if (user.room === currentRoom) {\n        setMessages(prev => [...prev, {\n          id: Date.now(),\n          system: true,\n          message: user.username + \" joined the room\",\n          timestamp: new Date().toISOString()\n        }]);\n      }\n    };\n    const onUserLeft = user => {\n      console.log(\"ðŸ”´ User left:\", user);\n      if (user.room === currentRoom) {\n        setMessages(prev => [...prev, {\n          id: Date.now(),\n          system: true,\n          message: user.username + \" left the room\",\n          timestamp: new Date().toISOString()\n        }]);\n      }\n    };\n    const onTypingUsers = users => {\n      console.log(\"âŒ¨ï¸ Typing users:\", users);\n      setTypingUsers(users);\n    };\n    const onRoomList = roomList => {\n      console.log(\"ðŸ  Room list updated:\", roomList);\n      setRooms(roomList);\n    };\n    const onRoomChanged = data => {\n      console.log(\"ðŸ”„ Room changed:\", data);\n      setCurrentRoom(data.newRoom);\n\n      // Load messages for the new room from history\n      const roomMessages = messageHistory.get(data.newRoom) || [];\n      setMessages(roomMessages.slice(-50)); // Show last 50 messages\n    };\n    const onRoomCreated = roomName => {\n      console.log(\"ðŸ—ï¸ New room created:\", roomName);\n      setRooms(prev => [...prev, roomName]);\n    };\n    const onReactionUpdated = data => {\n      console.log(\"ðŸŽ­ Reaction updated:\", data);\n      updateMessageReactions(data.messageId, data.reactions);\n    };\n    const onReactionError = error => {\n      console.log(\"âŒ Reaction error:\", error);\n      alert(`Reaction error: ${error.error}`);\n    };\n    const onReadReceiptUpdated = data => {\n      console.log(\"ðŸ‘€ Read receipt updated:\", data);\n      updateMessageReadReceipts(data.messageId, data.readBy);\n    };\n    const onAllMessagesRead = data => {\n      console.log(\"ðŸ‘€ All messages read in room:\", data);\n      setMessages(prev => prev.map(msg => msg.room === data.room && msg.readBy && !msg.readBy.includes(data.username) ? {\n        ...msg,\n        readBy: [...msg.readBy, data.username]\n      } : msg));\n    };\n    const onPrivateMessageRead = data => {\n      console.log(\"ðŸ‘€ Private message read:\", data);\n      updatePrivateMessageReadStatus(data.messageId, data.readBy);\n    };\n    const onMoreMessagesLoaded = data => {\n      console.log(\"ðŸ“š More messages loaded:\", data);\n      if (data.room === currentRoom) {\n        // Add older messages to the beginning\n        setMessages(prev => [...data.messages, ...prev]);\n        setHasMoreMessages(prev => new Map(prev).set(data.room, data.hasMore));\n      }\n    };\n\n    // Register event listeners\n    socket.on(\"connect\", onConnect);\n    socket.on(\"disconnect\", onDisconnect);\n    socket.on(\"connect_error\", onConnectError);\n    socket.on(\"reconnect\", onReconnect);\n    socket.on(\"reconnect_attempt\", onReconnectAttempt);\n    socket.on(\"reconnect_error\", onReconnectError);\n    socket.on(\"reconnect_failed\", onReconnectFailed);\n    socket.on(\"receive_message\", onReceiveMessage);\n    socket.on(\"private_message\", onPrivateMessage);\n    socket.on(\"private_message_error\", onPrivateMessageError);\n    socket.on(\"user_list\", onUserList);\n    socket.on(\"user_joined\", onUserJoined);\n    socket.on(\"user_left\", onUserLeft);\n    socket.on(\"typing_users\", onTypingUsers);\n    socket.on(\"room_list\", onRoomList);\n    socket.on(\"room_changed\", onRoomChanged);\n    socket.on(\"room_created\", onRoomCreated);\n    socket.on(\"reaction_updated\", onReactionUpdated);\n    socket.on(\"reaction_error\", onReactionError);\n    socket.on(\"read_receipt_updated\", onReadReceiptUpdated);\n    socket.on(\"all_messages_read\", onAllMessagesRead);\n    socket.on(\"private_message_read\", onPrivateMessageRead);\n    socket.on(\"more_messages_loaded\", onMoreMessagesLoaded);\n\n    // Initial connection check\n    console.log(\"ðŸ” Initial socket state - connected:\", socket.connected, \"id:\", socket.id);\n\n    // Clean up event listeners\n    return () => {\n      socket.off(\"connect\", onConnect);\n      socket.off(\"disconnect\", onDisconnect);\n      socket.off(\"connect_error\", onConnectError);\n      socket.off(\"reconnect\", onReconnect);\n      socket.off(\"reconnect_attempt\", onReconnectAttempt);\n      socket.off(\"reconnect_error\", onReconnectError);\n      socket.off(\"reconnect_failed\", onReconnectFailed);\n      socket.off(\"receive_message\", onReceiveMessage);\n      socket.off(\"private_message\", onPrivateMessage);\n      socket.off(\"private_message_error\", onPrivateMessageError);\n      socket.off(\"user_list\", onUserList);\n      socket.off(\"user_joined\", onUserJoined);\n      socket.off(\"user_left\", onUserLeft);\n      socket.off(\"typing_users\", onTypingUsers);\n      socket.off(\"room_list\", onRoomList);\n      socket.off(\"room_changed\", onRoomChanged);\n      socket.off(\"room_created\", onRoomCreated);\n      socket.off(\"reaction_updated\", onReactionUpdated);\n      socket.off(\"reaction_error\", onReactionError);\n      socket.off(\"read_receipt_updated\", onReadReceiptUpdated);\n      socket.off(\"all_messages_read\", onAllMessagesRead);\n      socket.off(\"private_message_read\", onPrivateMessageRead);\n      socket.off(\"more_messages_loaded\", onMoreMessagesLoaded);\n    };\n  }, [currentRoom]);\n  return {\n    socket,\n    isConnected,\n    isReconnecting,\n    connectionError,\n    lastMessage,\n    messages,\n    privateMessages,\n    users,\n    typingUsers,\n    rooms,\n    currentRoom,\n    messageHistory,\n    hasMoreMessages,\n    connect,\n    disconnect,\n    sendMessage,\n    sendFileMessage,\n    sendPrivateMessage,\n    addReaction,\n    removeReaction,\n    markMessageRead,\n    markAllMessagesRead,\n    markPrivateMessageRead,\n    changeRoom,\n    createRoom,\n    loadMoreMessages,\n    loadMoreMessagesSocket,\n    uploadFile,\n    setTyping\n  };\n};\n_s(useSocket, \"TcQrSnpvMWNnQrKcld19F/g1Zrg=\");","map":{"version":3,"names":["io","useEffect","useState","SOCKET_URL","process","env","REACT_APP_SOCKET_URL","socket","autoConnect","reconnection","reconnectionAttempts","reconnectionDelay","reconnectionDelayMax","timeout","transports","REACTION_TYPES","like","love","laugh","wow","sad","angry","useSocket","_s","isConnected","setIsConnected","connected","isReconnecting","setIsReconnecting","connectionError","setConnectionError","lastMessage","setLastMessage","messages","setMessages","privateMessages","setPrivateMessages","users","setUsers","typingUsers","setTypingUsers","rooms","setRooms","currentRoom","setCurrentRoom","messageHistory","setMessageHistory","Map","hasMoreMessages","setHasMoreMessages","connect","username","room","console","log","emit","disconnect","sendMessage","messageData","sendFileMessage","fileData","sendPrivateMessage","to","message","from","addReaction","messageId","reactionType","removeReaction","markMessageRead","markAllMessagesRead","markPrivateMessageRead","fromUser","changeRoom","newRoom","createRoom","roomName","loadMoreMessages","page","response","fetch","ok","Error","data","json","error","loadMoreMessagesSocket","limit","setTyping","isTyping","uploadFile","file","formData","FormData","append","method","body","fileInfo","updateMessageReactions","newReactions","prev","map","msg","id","reactions","updateMessageReadReceipts","readBy","updatePrivateMessageReadStatus","read","addMessagesToHistory","newMessages","newHistory","existingMessages","get","messageIds","Set","m","uniqueNewMessages","filter","has","set","onConnect","onDisconnect","reason","onConnectError","onReconnect","attemptNumber","onReconnectAttempt","onReconnectError","onReconnectFailed","onReceiveMessage","system","some","onPrivateMessage","onPrivateMessageError","alert","onUserList","userList","onUserJoined","user","Date","now","timestamp","toISOString","onUserLeft","onTypingUsers","onRoomList","roomList","onRoomChanged","roomMessages","slice","onRoomCreated","onReactionUpdated","onReactionError","onReadReceiptUpdated","onAllMessagesRead","includes","onPrivateMessageRead","onMoreMessagesLoaded","hasMore","on","off"],"sources":["C:/Users/User/Desktop/MERNWEEK5/real-time-communication-with-socket-io-wacuk-a/client/src/socket/socket.js"],"sourcesContent":["// socket.js - Socket.io client setup\n\nimport { io } from \"socket.io-client\";\nimport { useEffect, useState } from \"react\";\n\n// Socket.io connection URL - fixed for Create React App\nconst SOCKET_URL = process.env.REACT_APP_SOCKET_URL || \"http://localhost:5000\";\n\n// Create socket instance with enhanced configuration\nexport const socket = io(SOCKET_URL, {\n  autoConnect: true,\n  reconnection: true,\n  reconnectionAttempts: 10,\n  reconnectionDelay: 1000,\n  reconnectionDelayMax: 5000,\n  timeout: 20000,\n  transports: ['websocket', 'polling'] // Fallback support\n});\n\n// Available reaction types with emojis\nexport const REACTION_TYPES = {\n  like: 'ðŸ‘',\n  love: 'â¤ï¸',\n  laugh: 'ðŸ˜‚',\n  wow: 'ðŸ˜®',\n  sad: 'ðŸ˜¢',\n  angry: 'ðŸ˜ '\n};\n\n// Custom hook for using socket.io\nexport const useSocket = () => {\n  const [isConnected, setIsConnected] = useState(socket.connected);\n  const [isReconnecting, setIsReconnecting] = useState(false);\n  const [connectionError, setConnectionError] = useState(null);\n  const [lastMessage, setLastMessage] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [privateMessages, setPrivateMessages] = useState([]);\n  const [users, setUsers] = useState([]);\n  const [typingUsers, setTypingUsers] = useState([]);\n  const [rooms, setRooms] = useState([]);\n  const [currentRoom, setCurrentRoom] = useState('general');\n  const [messageHistory, setMessageHistory] = useState(new Map()); // Room -> messages\n  const [hasMoreMessages, setHasMoreMessages] = useState(new Map()); // Room -> boolean\n\n  // Connect to socket server\n  const connect = (username, room = 'general') => {\n    console.log(\"ðŸš€ Emitting user_join event with username:\", username, \"room:\", room);\n    if (username) {\n      socket.emit(\"user_join\", { username, room });\n      setCurrentRoom(room);\n    }\n  };\n\n  // Disconnect from socket server\n  const disconnect = () => {\n    socket.disconnect();\n  };\n\n  // Send a public message\n  const sendMessage = (messageData) => {\n    console.log(\"ðŸ“¤ Sending public message:\", messageData);\n    socket.emit(\"send_message\", messageData);\n  };\n\n  // Send a file message\n  const sendFileMessage = (fileData) => {\n    console.log(\"ðŸ“ Sending file message:\", fileData);\n    socket.emit(\"send_file_message\", fileData);\n  };\n\n  // Send a private message\n  const sendPrivateMessage = (to, message, from) => {\n    console.log(\"ðŸ”’ Sending private message to:\", to, \"content:\", message);\n    socket.emit(\"private_message\", { to, message });\n  };\n\n  // Add reaction to message\n  const addReaction = (messageId, reactionType) => {\n    console.log(\"ðŸŽ­ Adding reaction:\", reactionType, \"to message:\", messageId);\n    socket.emit(\"add_reaction\", { messageId, reactionType });\n  };\n\n  // Remove reaction from message\n  const removeReaction = (messageId, reactionType) => {\n    console.log(\"ðŸŽ­ Removing reaction:\", reactionType, \"from message:\", messageId);\n    socket.emit(\"remove_reaction\", { messageId, reactionType });\n  };\n\n  // Mark message as read\n  const markMessageRead = (messageId) => {\n    console.log(\"ðŸ‘€ Marking message as read:\", messageId);\n    socket.emit(\"mark_message_read\", { messageId });\n  };\n\n  // Mark all messages as read in room\n  const markAllMessagesRead = (room) => {\n    console.log(\"ðŸ‘€ Marking all messages as read in room:\", room);\n    socket.emit(\"mark_all_read\", { room });\n  };\n\n  // Mark private message as read\n  const markPrivateMessageRead = (messageId, fromUser) => {\n    console.log(\"ðŸ‘€ Marking private message as read:\", messageId, \"from:\", fromUser);\n    socket.emit(\"mark_private_message_read\", { messageId, fromUser });\n  };\n\n  // Change room\n  const changeRoom = (newRoom) => {\n    console.log(\"ðŸ”„ Changing room to:\", newRoom);\n    socket.emit(\"change_room\", { newRoom });\n    setCurrentRoom(newRoom);\n    // Don't clear messages - they're stored per room now\n  };\n\n  // Create new room\n  const createRoom = (roomName) => {\n    console.log(\"ðŸ—ï¸ Creating new room:\", roomName);\n    socket.emit(\"create_room\", roomName);\n  };\n\n  // Load more messages (pagination)\n  const loadMoreMessages = async (room, page = 1) => {\n    console.log(\"ðŸ“š Loading more messages for room:\", room, \"page:\", page);\n    \n    try {\n      const response = await fetch(`http://localhost:5000/messages/${room}?page=${page}&limit=20`);\n      if (!response.ok) {\n        throw new Error('Failed to load messages');\n      }\n      \n      const data = await response.json();\n      return data;\n    } catch (error) {\n      console.error('Error loading more messages:', error);\n      throw error;\n    }\n  };\n\n  // Load more messages via socket (alternative method)\n  const loadMoreMessagesSocket = (room, page = 1) => {\n    console.log(\"ðŸ“š Loading more messages via socket for room:\", room, \"page:\", page);\n    socket.emit(\"load_more_messages\", { room, page, limit: 20 });\n  };\n\n  // Set typing status\n  const setTyping = (isTyping, room = currentRoom) => {\n    socket.emit(\"typing\", { isTyping, room });\n  };\n\n  // Upload file to server\n  const uploadFile = async (file) => {\n    const formData = new FormData();\n    formData.append('file', file);\n\n    try {\n      const response = await fetch('http://localhost:5000/upload', {\n        method: 'POST',\n        body: formData,\n      });\n\n      if (!response.ok) {\n        throw new Error('Upload failed');\n      }\n\n      const fileInfo = await response.json();\n      return fileInfo;\n    } catch (error) {\n      console.error('Upload error:', error);\n      throw error;\n    }\n  };\n\n  // Update message reactions\n  const updateMessageReactions = (messageId, newReactions) => {\n    setMessages(prev => prev.map(msg => \n      msg.id === messageId ? { ...msg, reactions: newReactions } : msg\n    ));\n  };\n\n  // Update message read receipts\n  const updateMessageReadReceipts = (messageId, readBy) => {\n    setMessages(prev => prev.map(msg => \n      msg.id === messageId ? { ...msg, readBy } : msg\n    ));\n  };\n\n  // Update private message read status\n  const updatePrivateMessageReadStatus = (messageId, readBy) => {\n    setPrivateMessages(prev => prev.map(msg => \n      msg.id === messageId ? { ...msg, read: true, readBy } : msg\n    ));\n  };\n\n  // Add messages to history for a room\n  const addMessagesToHistory = (room, newMessages) => {\n    setMessageHistory(prev => {\n      const newHistory = new Map(prev);\n      const existingMessages = newHistory.get(room) || [];\n      const messageIds = new Set(existingMessages.map(m => m.id));\n      \n      // Filter out duplicates and add new messages\n      const uniqueNewMessages = newMessages.filter(msg => !messageIds.has(msg.id));\n      newHistory.set(room, [...existingMessages, ...uniqueNewMessages]);\n      \n      return newHistory;\n    });\n  };\n\n  // Socket event listeners\n  useEffect(() => {\n    const onConnect = () => {\n      console.log(\"âœ… Connected to server, socket ID:\", socket.id);\n      setIsConnected(true);\n      setIsReconnecting(false);\n      setConnectionError(null);\n    };\n\n    const onDisconnect = (reason) => {\n      console.log(\"âŒ Disconnected from server. Reason:\", reason);\n      setIsConnected(false);\n      \n      if (reason === 'io server disconnect') {\n        // Server initiated disconnect, need to manually reconnect\n        socket.connect();\n      }\n    };\n\n    const onConnectError = (error) => {\n      console.log(\"ðŸ”Œ Connection error:\", error);\n      setConnectionError(error.message);\n      setIsReconnecting(false);\n    };\n\n    const onReconnect = (attemptNumber) => {\n      console.log(\"ðŸ”„ Reconnected after\", attemptNumber, \"attempts\");\n      setIsConnected(true);\n      setIsReconnecting(false);\n      setConnectionError(null);\n    };\n\n    const onReconnectAttempt = (attemptNumber) => {\n      console.log(\"ðŸ”„ Reconnection attempt:\", attemptNumber);\n      setIsReconnecting(true);\n    };\n\n    const onReconnectError = (error) => {\n      console.log(\"ðŸ”„ Reconnection error:\", error);\n      setConnectionError(error.message);\n    };\n\n    const onReconnectFailed = () => {\n      console.log(\"ðŸ”„ Reconnection failed\");\n      setIsReconnecting(false);\n      setConnectionError('Failed to reconnect to server');\n    };\n\n    const onReceiveMessage = (message) => {\n      console.log(\"ðŸ“¨ Received message for room:\", message.room, \"content:\", message);\n      \n      // Add to current messages if it's for the current room\n      if (!message.room || message.room === currentRoom || message.system) {\n        setLastMessage(message);\n        setMessages((prev) => {\n          // Prevent duplicates\n          if (prev.some(msg => msg.id === message.id)) return prev;\n          return [...prev, message];\n        });\n      }\n\n      // Always add to message history\n      if (message.room) {\n        addMessagesToHistory(message.room, [message]);\n      }\n    };\n\n    const onPrivateMessage = (message) => {\n      console.log(\"ðŸ”’ Received private message:\", message);\n      setPrivateMessages((prev) => {\n        // Prevent duplicates\n        if (prev.some(msg => msg.id === message.id)) return prev;\n        return [...prev, message];\n      });\n    };\n\n    const onPrivateMessageError = (error) => {\n      console.log(\"âŒ Private message error:\", error);\n      alert(`Error: ${error.error}`);\n    };\n\n    const onUserList = (userList) => {\n      console.log(\"ðŸ‘¥ User list updated:\", userList);\n      setUsers(userList);\n    };\n\n    const onUserJoined = (user) => {\n      console.log(\"ðŸŸ¢ User joined:\", user);\n      if (user.room === currentRoom) {\n        setMessages((prev) => [\n          ...prev,\n          {\n            id: Date.now(),\n            system: true,\n            message: user.username + \" joined the room\",\n            timestamp: new Date().toISOString(),\n          },\n        ]);\n      }\n    };\n\n    const onUserLeft = (user) => {\n      console.log(\"ðŸ”´ User left:\", user);\n      if (user.room === currentRoom) {\n        setMessages((prev) => [\n          ...prev,\n          {\n            id: Date.now(),\n            system: true,\n            message: user.username + \" left the room\",\n            timestamp: new Date().toISOString(),\n          },\n        ]);\n      }\n    };\n\n    const onTypingUsers = (users) => {\n      console.log(\"âŒ¨ï¸ Typing users:\", users);\n      setTypingUsers(users);\n    };\n\n    const onRoomList = (roomList) => {\n      console.log(\"ðŸ  Room list updated:\", roomList);\n      setRooms(roomList);\n    };\n\n    const onRoomChanged = (data) => {\n      console.log(\"ðŸ”„ Room changed:\", data);\n      setCurrentRoom(data.newRoom);\n      \n      // Load messages for the new room from history\n      const roomMessages = messageHistory.get(data.newRoom) || [];\n      setMessages(roomMessages.slice(-50)); // Show last 50 messages\n    };\n\n    const onRoomCreated = (roomName) => {\n      console.log(\"ðŸ—ï¸ New room created:\", roomName);\n      setRooms(prev => [...prev, roomName]);\n    };\n\n    const onReactionUpdated = (data) => {\n      console.log(\"ðŸŽ­ Reaction updated:\", data);\n      updateMessageReactions(data.messageId, data.reactions);\n    };\n\n    const onReactionError = (error) => {\n      console.log(\"âŒ Reaction error:\", error);\n      alert(`Reaction error: ${error.error}`);\n    };\n\n    const onReadReceiptUpdated = (data) => {\n      console.log(\"ðŸ‘€ Read receipt updated:\", data);\n      updateMessageReadReceipts(data.messageId, data.readBy);\n    };\n\n    const onAllMessagesRead = (data) => {\n      console.log(\"ðŸ‘€ All messages read in room:\", data);\n      setMessages(prev => prev.map(msg => \n        msg.room === data.room && msg.readBy && !msg.readBy.includes(data.username)\n          ? { ...msg, readBy: [...msg.readBy, data.username] }\n          : msg\n      ));\n    };\n\n    const onPrivateMessageRead = (data) => {\n      console.log(\"ðŸ‘€ Private message read:\", data);\n      updatePrivateMessageReadStatus(data.messageId, data.readBy);\n    };\n\n    const onMoreMessagesLoaded = (data) => {\n      console.log(\"ðŸ“š More messages loaded:\", data);\n      if (data.room === currentRoom) {\n        // Add older messages to the beginning\n        setMessages(prev => [...data.messages, ...prev]);\n        setHasMoreMessages(prev => new Map(prev).set(data.room, data.hasMore));\n      }\n    };\n\n    // Register event listeners\n    socket.on(\"connect\", onConnect);\n    socket.on(\"disconnect\", onDisconnect);\n    socket.on(\"connect_error\", onConnectError);\n    socket.on(\"reconnect\", onReconnect);\n    socket.on(\"reconnect_attempt\", onReconnectAttempt);\n    socket.on(\"reconnect_error\", onReconnectError);\n    socket.on(\"reconnect_failed\", onReconnectFailed);\n    socket.on(\"receive_message\", onReceiveMessage);\n    socket.on(\"private_message\", onPrivateMessage);\n    socket.on(\"private_message_error\", onPrivateMessageError);\n    socket.on(\"user_list\", onUserList);\n    socket.on(\"user_joined\", onUserJoined);\n    socket.on(\"user_left\", onUserLeft);\n    socket.on(\"typing_users\", onTypingUsers);\n    socket.on(\"room_list\", onRoomList);\n    socket.on(\"room_changed\", onRoomChanged);\n    socket.on(\"room_created\", onRoomCreated);\n    socket.on(\"reaction_updated\", onReactionUpdated);\n    socket.on(\"reaction_error\", onReactionError);\n    socket.on(\"read_receipt_updated\", onReadReceiptUpdated);\n    socket.on(\"all_messages_read\", onAllMessagesRead);\n    socket.on(\"private_message_read\", onPrivateMessageRead);\n    socket.on(\"more_messages_loaded\", onMoreMessagesLoaded);\n\n    // Initial connection check\n    console.log(\"ðŸ” Initial socket state - connected:\", socket.connected, \"id:\", socket.id);\n\n    // Clean up event listeners\n    return () => {\n      socket.off(\"connect\", onConnect);\n      socket.off(\"disconnect\", onDisconnect);\n      socket.off(\"connect_error\", onConnectError);\n      socket.off(\"reconnect\", onReconnect);\n      socket.off(\"reconnect_attempt\", onReconnectAttempt);\n      socket.off(\"reconnect_error\", onReconnectError);\n      socket.off(\"reconnect_failed\", onReconnectFailed);\n      socket.off(\"receive_message\", onReceiveMessage);\n      socket.off(\"private_message\", onPrivateMessage);\n      socket.off(\"private_message_error\", onPrivateMessageError);\n      socket.off(\"user_list\", onUserList);\n      socket.off(\"user_joined\", onUserJoined);\n      socket.off(\"user_left\", onUserLeft);\n      socket.off(\"typing_users\", onTypingUsers);\n      socket.off(\"room_list\", onRoomList);\n      socket.off(\"room_changed\", onRoomChanged);\n      socket.off(\"room_created\", onRoomCreated);\n      socket.off(\"reaction_updated\", onReactionUpdated);\n      socket.off(\"reaction_error\", onReactionError);\n      socket.off(\"read_receipt_updated\", onReadReceiptUpdated);\n      socket.off(\"all_messages_read\", onAllMessagesRead);\n      socket.off(\"private_message_read\", onPrivateMessageRead);\n      socket.off(\"more_messages_loaded\", onMoreMessagesLoaded);\n    };\n  }, [currentRoom]);\n\n  return {\n    socket,\n    isConnected,\n    isReconnecting,\n    connectionError,\n    lastMessage,\n    messages,\n    privateMessages,\n    users,\n    typingUsers,\n    rooms,\n    currentRoom,\n    messageHistory,\n    hasMoreMessages,\n    connect,\n    disconnect,\n    sendMessage,\n    sendFileMessage,\n    sendPrivateMessage,\n    addReaction,\n    removeReaction,\n    markMessageRead,\n    markAllMessagesRead,\n    markPrivateMessageRead,\n    changeRoom,\n    createRoom,\n    loadMoreMessages,\n    loadMoreMessagesSocket,\n    uploadFile,\n    setTyping,\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}